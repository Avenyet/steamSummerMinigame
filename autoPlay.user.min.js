!function(e){"use strict";function t(){return e.g_Minigame.m_CurrentScene}function n(){_e("Starting /u/wchill's script (version "+Pe+")",1),at=t().DoCritEffect,it=t().m_rgClickNumbers.push,rt=e.g_Minigame.Render,A(),Oe&&r(),ke&&e.CEnemy&&(e.CEnemy.prototype.TakeDamage=function(){},e.CEnemySpawner.prototype.TakeDamage=function(){},e.CEnemyBoss.prototype.TakeDamage=function(){}),we&&b(),Ue&&T();var n=document.getElementById("abilities");n&&(n.style.textAlign="left"),Ge&&(n=document.getElementById("global_header"),n&&n.parentNode&&n.parentNode.removeChild(n),n=document.getElementById("footer"),n&&n.parentNode&&n.parentNode.removeChild(n),n=document.getElementById("footer_spacer"),n&&n.parentNode&&n.parentNode.removeChild(n),n=document.querySelector(".pagecontent"),n&&(n.style["padding-bottom"]=0),document.body.style.backgroundPosition="0 0"),Fe&&g(qe),He&&Se(),Je&&C(),void 0!==e.CSceneGame&&(e.CSceneGame.prototype.DoScreenShake=function(){}),i();var a=document.createElement("span");a.className="toggle_music_btn",a.textContent="Easter Egg",a.onclick=function(){e.SmackTV()},document.querySelector(".game_options").insertBefore(a,document.querySelector(".leave_game_btn"));var o=document.querySelector(".title_activity"),l=document.createElement("span");l.innerHTML='<span id="players_in_game">0/1500</span>&nbsp;Players in room<br>',o.insertBefore(l,o.firstChild);var m=document.getElementById("activitylog");m.style.marginTop="33px";var p=document.createElement("div");document.getElementsByClassName("pagecontent")[0].insertBefore(p,document.getElementsByClassName("footer_spacer")[0]),p.className="options_box";var _=document.querySelector(".options_box");_||(_=document.querySelector(".options_box")),_.innerHTML="<b>OPTIONS</b> (v"+Pe+')<br>Settings marked with a <span style="color:#FF5252;font-size:22px;line-height:4px;vertical-align:bottom;">*</span> requires a refresh to take effect.<hr>',_.className="options_box",_.style.backgroundColor="#000000",_.style.width="600px",_.style.marginTop="12px",_.style.padding="12px",_.style.boxShadow="2px 2px 0 rgba( 0, 0, 0, 0.6 )",_.style.color="#ededed",_.style.marginLeft="auto",_.style.marginRight="auto";var h=_.cloneNode(!0),S=document.createElement("div");S.style["-moz-column-count"]=3,S.style["-webkit-column-count"]=3,S.style["column-count"]=3,S.style.width="100%",S.appendChild(s("enableAutoClicker","Enable autoclicker",Ie,E,!1)),S.appendChild(s("removeInterface","Remove interface",Ge,u,!0)),S.appendChild(s("removeParticles","Remove particle effects",Oe,u,!0)),S.appendChild(s("removeFlinching","Remove flinching effects",ke,u,!0)),S.appendChild(s("removeCritText","Remove crit text",we,b,!1)),S.appendChild(s("removeGoldText","Remove gold text",Be,u,!1)),S.appendChild(s("removeAllText","Remove all text",Ue,T,!1)),S.appendChild(s("disableRenderer","Throttle game renderer",Je,C,!0)),"undefined"!=typeof GM_info&&S.appendChild(s("enableAutoRefresh","Enable auto-refresh",Fe,v,!1)),S.appendChild(s("enableFingering","Enable targeting pointer",He,u,!0)),S.appendChild(s("useTrollTracker","Track improper ability use",$e,u,!0)),S.appendChild(s("praiseGoldHelm","Praise Gold Helm!",We,y,!1)),S.appendChild(c("praiseGoldHelmImage","",tt,et,f)),S.appendChild(d("setLogLevel","Change the log level","25px",Ne,0,5,R)),_.appendChild(S),h.innerHTML="<b>GAME INFO</b><br/>",h.className="info_box",h.style.right="0px",ut=document.createElement("div"),ut.style["-moz-column-count"]=3,ut.style["-webkit-column-count"]=3,ut.style["column-count"]=3,ut.appendChild(document.createElement("div")),ut.appendChild(document.createElement("div")),ut.appendChild(document.createElement("div")),h.appendChild(ut),_.parentElement.appendChild(h);var D=document.querySelector(".leave_game_helper");D.parentElement.removeChild(D),Re(),De(),Ae();var L=e.g_Minigame.CurrentScene().m_rgPlayerTechTree.badge_points;900>L?(e.g_Minigame.CurrentScene().TrySpendBadgePoints(e.$J("<a data-type='18' data-cost='10'></a>"),Math.floor(L/10)),L%=10):(e.g_Minigame.CurrentScene().TrySpendBadgePoints(e.$J("<a data-type='18' data-cost='10'></a>"),90),L-=900),e.g_Minigame.CurrentScene().TrySpendBadgePoints(e.$J("<a data-type='26' data-cost='100'></a>"),Math.floor(L/100*.9)),e.g_Minigame.CurrentScene().TrySpendBadgePoints(e.$J("<a data-type='27' data-cost='100'></a>"),Math.floor(L/100*.1)),L%=100,e.g_Minigame.CurrentScene().TrySpendBadgePoints(e.$J("<a data-type='19' data-cost='1'></a>"),L)}function a(){for(var e={1:":shelterwildfire:",2:":waterrune:",3:":Wisp:",4:":FateTree:"},n=0;3>n;n++){var a=t().m_rgGameData.lanes[n].element,i=t().m_rgLaneData[n].abilities;i||(i={});for(var r=[],o=0;4>o;o++){var l=t().GetEnemy(n,o);l&&r.push(l)}var m=t().m_rgLaneData[n].players,c="Lane "+(n+1)+' - <img src="http://cdn.steamcommunity.com/economy/emoticon/'+e[a]+'"><br>'+m+" players";ut.children[n].innerHTML=c}}function i(){We?(e.$J(".tv_ui").css("background-image","url("+tt+")"),e.$J(".pagecontent").attr("style","padding-bottom: 0px; background-image: url('http://cdn.akamai.steamstatic.com/steamcommunity/public/images/items/368020/7b933b3766d64ec0525c86891dedb4b699a25fb9.jpg')")):e.$J(".tv_ui").css("background-image","url("+nt+")"),e.$J("#activeinlanecontainer").css("height","154px"),e.$J("#activitycontainer").css("height","270px"),e.$J("#activityscroll").css("height","270px")}function r(){e.CSceneGame&&(e.CSceneGame.prototype.DoScreenShake=function(){},Oe&&(e.CSceneGame.prototype.SpawnEmitter=function(e){return e.emit=!1,e}))}function o(){var e=new Date,t=e.getUTCHours(),n=e.getUTCMinutes(),a=60-n;return 15==t&&a<=ot.minsLeft?!0:!1}function l(){if(!Ve){Ve=!0;var n=Le();if(10>n&&ot.useSlowMode)return;ze=1e5>n||Ye,a(),Y(),X(),K(),n%ot.rainingRounds===0?N():I(),G(),k(),O(),U(),W(),w(),B(),F(),H(),J(),(n<ot.speedThreshold||n%ot.rainingRounds===0)&&n>ot.useGoldThreshold&&$(),H(n),z(n),q(),x(),n!==Ze&&(Ze=n,m()),ye(n),je=S(),t().m_nClicks=je,t().m_nLastTick=!1,e.g_msTickRate=1e3;var i=t().CalculateDamage(t().m_rgPlayerTechTree.damage_per_click,t().m_rgGameData.lanes[t().m_rgPlayerData.current_lane].element);_e("Ticked. Current clicks per second: "+je+". Current damage per second: "+i*je,4),Je&&(t().Tick(),requestAnimationFrame(function(){e.g_Minigame.Renderer.render(t().m_Container)})),Ve=!1;var r=t().GetEnemy(t().m_rgPlayerData.current_lane,t().m_rgPlayerData.target);if(je>0&&r){if(P(r.m_Sprite.position.x-440*r.m_nLane,r.m_Sprite.position.y-52,"-"+e.FormatNumberForDisplay(i*je,5),"#aaf"),t().m_rgStoredCrits.length>0){var o=t().m_rgStoredCrits.reduce(function(e,t){return e+t});t().m_rgStoredCrits.length=0,t().DoCritEffect(o,r.m_Sprite.position.x-440*r.m_nLane,r.m_Sprite.position.y+17,"Crit!")}var l=t().m_rgGameData.lanes[t().m_rgPlayerData.current_lane].active_player_ability_gold_per_click;if(l>0&&r.m_data.hp>0){var c=r.m_data.gold*l*je;t().ClientOverride("player_data","gold",t().m_rgPlayerData.gold+c),t().ApplyClientOverrides("player_data",!0),_e("Raining gold ability is active in current lane. Percentage per click: "+l+"%. Approximately gold per second: "+c,4),Be||P(r.m_Sprite.position.x-440*r.m_nLane,r.m_Sprite.position.y-17,"+"+e.FormatNumberForDisplay(c,5),"#e1b21e")}}}e.CUI&&!lt&&(lt=!0,_e("Anti nuke in effect",1),e.CUI.prototype.UpdateLog=function(t){this.m_Game.m_rgTuningData.abilities;if(this.m_Game.m_rgPlayerTechTree){for(var n=0,a=t.length-1;a>=0;a--){var i=t[a];if(isNaN(i.time)&&(i.time=this.m_nActionLogTime+1),!(i.time<=this.m_nActionLogTime)){switch(i.type){case"ability":var r=this.m_eleUpdateLogTemplate.clone();$e?Le()%100===0&&[10,11,12,15,20].indexOf(i.ability)>-1?(e.$J(r).data("abilityid",i.ability),e.$J(".name",r).text(i.actor_name),e.$J(".ability",r).text(this.m_Game.m_rgTuningData.abilities[i.ability].name+" on level "+Le()),e.$J("img",r).attr("src",e.g_rgIconMap["ability_"+i.ability].icon),e.$J(r).v_tooltip({tooltipClass:"ta_tooltip",location:"top"}),this.m_eleUpdateLogContainer[0].insertBefore(r[0],this.m_eleUpdateLogContainer[0].firstChild),_e(i.actor_name+" used "+this.m_Game.m_rgTuningData.abilities[i.ability].name+" on level "+Le(),1),e.$J(".name",r).attr("style","color: red; font-weight: bold;")):Le()%100!==0&&Le()%10>3&&26===i.ability&&(e.$J(r).data("abilityid",i.ability),e.$J(".name",r).text(i.actor_name),e.$J(".ability",r).text(this.m_Game.m_rgTuningData.abilities[i.ability].name+" on level "+Le()),e.$J("img",r).attr("src",e.g_rgIconMap["ability_"+i.ability].icon),e.$J(".name",r).attr("style","color: yellow"),e.$J(r).v_tooltip({tooltipClass:"ta_tooltip",location:"top"}),this.m_eleUpdateLogContainer[0].insertBefore(r[0],this.m_eleUpdateLogContainer[0].firstChild)):(e.$J(r).data("abilityid",i.ability),e.$J(".name",r).text(i.actor_name),e.$J(".ability",r).text(this.m_Game.m_rgTuningData.abilities[i.ability].name+" on level "+Le()),e.$J("img",r).attr("src",e.g_rgIconMap["ability_"+i.ability].icon),e.$J(r).v_tooltip({tooltipClass:"ta_tooltip",location:"top"}),this.m_eleUpdateLogContainer[0].insertBefore(r[0],this.m_eleUpdateLogContainer[0].firstChild));break;default:console.log("Unknown action log type: %s",i.type),console.log(i)}i.time>n&&(n=i.time)}}n>this.m_nActionLogTime&&(this.m_nActionLogTime=n);for(var o=this.m_eleUpdateLogContainer[0];o.children.length>20;)o.children[o.children.length-1].remove()}},this.m_eleUpdateLogContainer&&(this.m_eleUpdateLogContainer[0].innerHTML=""))}function m(){_e("Refreshing player data",2),e.g_Server.GetPlayerData(function(n){var a=t();n.response.player_data&&(a.m_rgPlayerData=n.response.player_data,a.ApplyClientOverrides("player_data"),a.ApplyClientOverrides("ability")),n.response.tech_tree&&(a.m_rgPlayerTechTree=n.response.tech_tree,n.response.tech_tree.upgrades?a.m_rgPlayerUpgrades=e.V_ToArray(n.response.tech_tree.upgrades):a.m_rgPlayerUpgrades=[]),a.OnReceiveUpdate()},function(){},!0)}function c(e,t,n,a,i){var r=document.createElement("label"),o=document.createTextNode(t),l=document.createElement("select");for(var m in a){var c=document.createElement("option");c.value=a[m],c.textContent=m,a[m]==n&&(c.selected=!0),l.appendChild(c)}return l.name=e,l.style.marginRight="5px",l.onchange=i,r.appendChild(l),r.appendChild(o),r.appendChild(document.createElement("br")),r}function d(t,n,a,i,r,o,l){var m=document.createElement("label"),c=document.createTextNode(n),d=document.createElement("input");return d.type="number",d.name=t,d.style.width=a,d.style.marginRight="5px",d.value=i,d.min=r,d.max=o,d.onchange=l,e[d.name]=d,m.appendChild(d),m.appendChild(c),m.appendChild(document.createElement("br")),m}function s(t,n,a,i,r){var o=document.createElement("span");o.appendChild(document.createTextNode("*")),o.style.color="#FF5252",o.style.fontSize="22px",o.style.lineHeight="14px",o.style.verticalAlign="bottom";var l=document.createElement("label"),m=document.createTextNode(n),c=document.createElement("input");return c.type="checkbox",c.name=t,c.checked=a,c.onclick=i,e[c.name]=c.checked,l.appendChild(c),l.appendChild(m),r&&l.appendChild(o),l.appendChild(document.createElement("br")),l}function u(e){_(e)}function g(e){var t=60*(e+Ke*Math.random())*1e3;Qe=setTimeout(function(){p()},t)}function p(){var n=t().GetEnemy(t().m_rgPlayerData.current_lane,t().m_rgPlayerData.target).m_data;if("undefined"!=typeof n){var a=n.type;a!=_t.BOSS?(_e("Refreshing, not boss",5),e.location.reload(!0)):(_e("Not refreshing, A boss!",5),setTimeout(p,3e3))}else setTimeout(p,1e3)}function _(t){var n=t.target;return D(n.name,n.checked),e[n.name]=n.checked,n.checked}function h(t){var n=t.target;return D(n.name,n.value),e[n.name]=n.value,n.value}function y(e){void 0!==e&&(We=_(e)),i()}function f(e){void 0!==e&&(tt=h(e)),i()}function E(e){var t=Ie;void 0!==e&&(t=_(e)),Ie=t,_e("Autoclicker is "+Ie,1)}function v(e){var t=Fe;void 0!==e&&(t=_(e)),t?g(qe):clearTimeout(Qe)}function C(t){var n=Je;void 0!==t&&(n=Je=_(t));var a=e.PIXI.ticker.shared;n?(a.autoStart=!1,a.stop(),e.g_Minigame.Render=function(){}):(a.autoStart=!0,a.start(),e.g_Minigame.Render=rt,e.g_Minigame.Render())}function b(e){var n=we;void 0!==e&&(n=_(e)),n?t().DoCritEffect=function(e,t,n,a){}:t().DoCritEffect=at}function T(e){var n=Ue;void 0!==e&&(n=_(e)),n?t().m_rgClickNumbers.push=function(e){e.container.removeChild(e)}:t().m_rgClickNumbers.push=it}function S(){var e=Le();return Ie?e%ot.rainingRounds===0?me(gt.WORMHOLE)?0:Math.floor(xe/2):e%ot.rainingRounds>ot.rainingRounds-ot.rainingSafeRounds?Math.floor(xe/10):e%ot.rainingRounds>ot.rainingRounds-2*ot.rainingSafeRounds?Math.floor(xe/5):xe:0}function R(e){void 0!==e&&(Ne=e.target.value)}function D(e,t){try{"undefined"!==localStorage&&localStorage.setItem("steamdb-minigame/"+e,t)}catch(n){console.log(n)}}function L(e,t){try{if("undefined"!==localStorage){var n=localStorage.getItem("steamdb-minigame/"+e);return null!==n?n:t}}catch(a){return console.log(a),t}}function M(e,t){return"true"==L(e,t.toString())}function A(){for(var e=document.querySelector('a.link.element_upgrade_btn[data-type="3"]'),t=document.querySelector('a.link.element_upgrade_btn[data-type="4"]'),n=document.querySelector('a.link.element_upgrade_btn[data-type="5"]'),a=document.querySelector('a.link.element_upgrade_btn[data-type="6"]'),i=[e,t,n,a],r=0;r<i.length;r++)i[r].style.visibility="hidden"}function P(n,a,i,r){var o=new e.PIXI.Text(i,{font:"35px 'Press Start 2P'",fill:r,stroke:"#000",strokeThickness:2});o.x=n,o.y=a,t().m_containerUI.addChild(o),o.container=t().m_containerUI;var l=new e.CEasingSinOut(o.y,-200,1e3);l.parent=o,o.m_easeY=l,l=new e.CEasingSinOut(2,-2,1e3),l.parent=o,o.m_easeAlpha=l,t().m_rgClickNumbers.push(o)}function x(){var e=t().m_rgLaneData[0].players+t().m_rgLaneData[1].players+t().m_rgLaneData[2].players;document.getElementById("players_in_game").innerHTML=e+"/1500"}function N(){var e=0,n=t().GetEnemy(0,0).m_data;if("undefined"!=typeof n){var a=n.type;a==_t.BOSS&&(_e("In lane 0, there is a boss, avoiding",4),e=1)}t().m_nExpectedLane!=e&&(_e("Switching to raining lane"+e,3),t().TryChangeLane(e))}function I(){for(var e,n=.4,a=.1,i=!1,r=0,l=0,m=0,c=0,d=-1,s=-1,u=[_t.TREASURE,_t.BOSS,_t.MINIBOSS,_t.SPAWNER,_t.CREEP],g=!1,p=0,_=0,h=!1,y=!1,f=0;!i&&f<u.length;f++){h=u[f]==_t.TREASURE,y=u[f]==_t.BOSS;var E=[];for(e=0;3>e;e++)for(var v=0;4>v;v++){var C=t().GetEnemy(e,v);C&&C.m_data.type==u[f]&&(E[E.length]=C)}if(!h&&!y)for(var b=0,T=se(),S=0;S<T.length;S++)if(e=T[S],0!==t().m_rgGameData.lanes[e].dps){var R=0;"undefined"!=typeof t().m_rgLaneData[e].abilities[17]&&(R=t().m_rgLaneData[e].abilities[17],_e("stacks: "+R,3));for(var D=0;D<t().m_rgEnemies.length;D++){var L=t().m_rgEnemies[D].m_data.gold;R*L>b&&(b=R*L,s=t().m_rgEnemies[D].m_nID,d=e)}}var M=0;for(e=0;e<E.length;e++)if(E[e]&&!E[e].m_bIsDestroyed){if(1>r||E[e].m_flDisplayedHP<r){var A=t().m_rgGameData.lanes[E[e].m_nLane].element,P=t().CalculateDamage(t().m_rgPlayerTechTree.dps,A);if(!(P>=M))continue;M=P,i=!0,r=E[e].m_flDisplayedHP,l=E[e].m_nLane,m=E[e].m_nID}var x=E[e].m_flDisplayedHP/E[e].m_data.max_hp;(0===c||c>x)&&(c=x)}-1!=d&&-1!=s&&(l=d,m=s,_e("Switching to a lane with best raining gold benefit",2)),u[f]==_t.SPAWNER&&c>n&&-1==d&&(p=l,_=m,g=!0,i=!1),g&&u[f]==_t.CREEP&&c>a&&(l=p,m=_)}if(i){t().m_nExpectedLane!=l&&(_e("Switching to lane"+l,3),t().TryChangeLane(l)),t().m_nTarget!=m&&(_e("Switching targets",3),t().TryChangeTarget(m));var N=Le();h||y&&(N<ot.speedThreshold||N%ot.rainingRounds===0)?pt.forEach(V):pt.forEach(Q),N<ot.allowWormholeLevel&&!o()||Q(gt.WORMHOLE)}}function G(){return ge(gt.DECREASE_COOLDOWNS)>0||Math.random()>ot.useAbilityChance?void V(gt.DECREASE_COOLDOWNS):(Z(gt.DECREASE_COOLDOWNS)||Q(gt.DECREASE_COOLDOWNS),void ae(gt.DECREASE_COOLDOWNS))}function O(e){return ce(gt.PUMPED_UP)?void _e("Pumped up is always good.",2):(ae(gt.MEDICS)&&_e("Medics is purchased, cooled down. Trigger it.",2),void(e>ot.reflectDamageThreshold&&ce(gt.REFLECT_DAMAGE)?_e("We have reflect damage, cooled down. Trigger it.",2):e>ot.stealHealthThreshold&&ce(gt.STEAL_HEALTH)?_e("We have steal health, cooled down. Trigger it.",2):ce(gt.GOD_MODE)&&_e("We have god mode, cooled down. Trigger it.",2)))}function k(){ce(gt.CRIT)&&_e("Crit chance is always good.",3),ae(gt.GOOD_LUCK_CHARMS)&&_e("Good Luck Charms is purchased, cooled down, and needed. Trigger it.",2)}function w(){if(te(gt.CLUSTER_BOMB)&&ne()&&!(Math.random()>ot.useAbilityChance)){for(var e=t().m_nExpectedLane,n=0,a=!1,i=Le(),r=0;4>r;r++){var o=t().GetEnemy(e,r);o&&(n++,(0===o.m_data.type||i>ot.speedThreshold&&i%ot.rainingRounds!==0&&i%10===0)&&(a=!0))}a&&n>=3&&ie(gt.CLUSTER_BOMB)}}function B(){if(te(gt.NAPALM)&&ne()&&!(Math.random()>ot.useAbilityChance)){var e=t().m_nExpectedLane,n=0,a=!1,i=Le();if(!(i%ot.rainingRounds>ot.rainingRounds-ot.rainingSafeRounds)){for(var r=0;4>r;r++){var o=t().GetEnemy(e,r);o&&(n++,(0===o.m_data.type||i>ot.speedThreshold&&i%ot.rainingRounds!==0&&i%10===0)&&(a=!0))}a&&n>=3&&ie(gt.NAPALM)}}}function U(){if(te(gt.MORALE_BOOSTER)&&!(Math.random()>ot.useAbilityChance)){for(var e=0,n=0;n<t().m_rgGameData.lanes[t().m_nExpectedLane].enemies.length;n++)t().m_rgGameData.lanes[t().m_nExpectedLane].enemies[n].hp>1e6&&e++;e>=2&&(_e("Moral Booster is purchased, cooled down, and needed. Trigger it.",2),ie(gt.MORALE_BOOSTER))}}function F(){if(te(gt.TACTICAL_NUKE)&&ne()&&!(Math.random()>ot.useAbilityChance)){for(var e=t().m_nExpectedLane,n=!1,a=0,i=Le(),r=0;4>r;r++){var o=t().GetEnemy(e,r);o&&(0===o.m_data.type||i>ot.speedThreshold&&i%ot.rainingRounds!==0&&i%10===0)&&(n=!0,a=o.m_flDisplayedHP/o.m_data.max_hp)}n&&.6>a&&a>.3&&(_e("Tactical Nuke is purchased, cooled down, and needed. Nuke 'em.",2),ie(gt.TACTICAL_NUKE))}}function H(){}function J(){if(le(gt.CRIPPLE_SPAWNER)&&!(Math.random()>ot.useAbilityChance)){for(var e=t().m_nExpectedLane,n=!1,a=0,i=0;4>i;i++){var r=t().GetEnemy(e,i);r&&0===r.m_data.type&&(n=!0,a=r.m_flDisplayedHP/r.m_data.max_hp)}n&&a>.95&&(_e("Cripple Spawner available, and needed. Cripple 'em.",2),de(gt.CRIPPLE_SPAWNER))}}function $(){if(le(gt.RAINING_GOLD)){var e=t().GetEnemy(t().m_rgPlayerData.current_lane,t().m_rgPlayerData.target);if(e&&e.m_data.type==_t.BOSS){var n=e.m_flDisplayedHP/e.m_data.max_hp;n>=.6&&(_e("Gold rain is purchased and cooled down, Triggering it on boss",2),de(gt.RAINING_GOLD))}}}function W(){if((Le()<=30||Le()>=1e5)&&le(gt.TREASURE)&&de(gt.TREASURE),te(gt.METAL_DETECTOR)||le(gt.TREASURE)){if(Z(gt.METAL_DETECTOR))return;var e=t().GetEnemy(t().m_rgPlayerData.current_lane,t().m_rgPlayerData.target);if(e&&e.m_data.type==_t.BOSS){var n=e.m_flDisplayedHP/e.m_data.max_hp;.25>=n&&(te(gt.METAL_DETECTOR)?(_e("Metal Detector is purchased and cooled down, Triggering it on boss",2),ie(gt.METAL_DETECTOR)):le(gt.TREASURE)&&(_e("Treasure is available and cooled down, Triggering it on boss",2),de(gt.TREASURE)))}}}function q(){Z(gt.MAX_ELEMENTAL_DAMAGE)||Math.random()>ot.useAbilityChance||ce(gt.MAX_ELEMENTAL_DAMAGE,!0)&&_e("Max Elemental Damage is purchased and cooled down, triggering it.",2)}function K(){var t=Le();return t%ot.rainingRounds===0||ze?void(st||(st=e.setInterval(function(){e.g_Minigame.m_CurrentScene.m_rgAbilityQueue.push({ability:26}),e.g_Minigame.m_CurrentScene.m_nLastTick=0,e.g_Minigame.m_CurrentScene.Tick()},100))):void(st&&(e.clearInterval(st),st=!1))}function X(){var e=Le();if(e%ot.rainingRounds===0||Ye){var n=(ue()-t().m_rgGameData.timestamp_game_start)/3600,a=(ot.useLikeNewMaxChance-ot.useLikeNewMinChance)*n/24+ot.useLikeNewMinChance;Math.random()>a&&!Ye||(e=Le(),(e%ot.rainingRounds===0||Ye)&&ie(gt.LIKE_NEW)&&_e("We can actually use Like New semi-reliably! Cooldowns-b-gone.",2))}}function z(e){e%10===9&&Math.random()<=ot.useAbilityChance&&ce(gt.RESURRECTION)&&_e("Triggered Resurrect.")}function Y(){t().m_bIsDead&&t().m_rgPlayerData.time_died+5<t().m_nTime&&e.RespawnPlayer()}function V(e){j(e,!1)}function Q(e){j(e,!0)}function j(e,t){var n=t===!0?"visible":"hidden",a=document.getElementById("ability_"+e);a||(a=document.getElementById("abilityitem_"+e)),a&&a.childElements()&&a.childElements().length>=1&&(a.childElements()[0].style.visibility=n)}function Z(e){return t().bIsAbilityActive(e)}function ee(e){var t=document.getElementById("ability_"+e);return t&&t.childElements()&&t.childElements().length>=1?"hidden"!==t.childElements()[0].style.visibility:!1}function te(e){return oe(e)&&!re(e)&&ee(e)}function ne(){var e=Le(),t=e%ot.rainingRounds;return e>=99999999||t>0&&t<ot.rainingRounds-ot.rainingSafeRounds}function ae(e){return te(e)?(ie(e),!0):!1}function ie(e){t().m_rgAbilityQueue.push({ability:e})}function re(e){return t().GetCooldownForAbility(e)>0}function oe(e){return 1<<e&t().m_rgPlayerTechTree.unlocked_abilities_bitfield}function le(e){return me(e)&&!re(e)&&pe(e)}function me(e){for(var n=0;n<t().m_rgPlayerTechTree.ability_items.length;++n){var a=t().m_rgPlayerTechTree.ability_items[n];if(a.ability==e)return!0}return!1}function ce(e,t){return le(e)?t&&ge(e)>0?!1:(de(e),!0):!1}function de(e){var n=document.getElementById("abilityitem_"+e);n&&n.childElements()&&n.childElements().length>=1&&t().TryAbility(document.getElementById("abilityitem_"+e).childElements()[0])}function se(){for(var e=[t().m_rgPlayerTechTree.damage_multiplier_fire,t().m_rgPlayerTechTree.damage_multiplier_water,t().m_rgPlayerTechTree.damage_multiplier_air,t().m_rgPlayerTechTree.damage_multiplier_earth],n=t().m_rgGameData.lanes,a=[],i=0;i<n.length;i++)a[i]=i;return a.sort(function(t,a){return e[n[a].element-1]-e[n[t].element-1]}),_e("Lane IDs  : "+a[0]+" "+a[1]+" "+a[2],4),_e("Elements  : "+n[a[0]].element+" "+n[a[1]].element+" "+n[a[2]].element,4),a}function ue(){return t().m_rgGameData.timestamp}function ge(e){for(var n=ue(),a=t().m_rgGameData.lanes[t().m_rgPlayerData.current_lane].active_player_abilities,i=0,r=0;r<a.length;r++)a[r].ability!=e||a[r].timestamp_done<n||i++;return i}function pe(e){var t=document.getElementById("abilityitem_"+e);return t&&t.childElements()&&t.childElements().length>=1?"hidden"!==t.childElements()[0].style.visibility:!1}function _e(e,t){Ne>=t&&console.log(e)}function he(e){for(var t=0,n=0,a=0;24>a;a++)e>=3600&&(e-=3600,t+=1);for(var i=0;60>i;i++)e>=60&&(e-=60,n+=1);return{hours:t,minutes:n}}function ye(n){var a=Math.floor(t().m_nTime)%86400;a-=57600,0>a&&(a+=86400);var i=86400-a,r=he(i);document.ExpectedLevel.textContent="Level: "+e.FormatNumberForDisplay(n,5)+", Expected Jump: "+e.FormatNumberForDisplay(Me(),5),document.RemainingTime.textContent="Remaining Time: "+r.hours+" hours, "+r.minutes+" minutes."}function fe(){return 100*t().m_rgPlayerTechTree.crit_percentage}function Ee(){return t().m_rgPlayerTechTree.damage_multiplier_crit}function ve(){return t().m_rgPlayerTechTree.dps}function Ce(){return t().m_rgPlayerTechTree.damage_per_click}function be(){return t().m_rgPlayerTechTree.damage_per_click_multiplier}function Te(){return 100*t().m_rgPlayerTechTree.boss_loot_drop_percentage}function Se(){e.CSceneGame.prototype.ClearNewPlayer=function(){},t().m_spriteFinger||(e.WebStorage.SetLocal("mg_how2click",0),t().CheckNewPlayer(),e.WebStorage.SetLocal("mg_how2click",1)),document.getElementById("newplayer").style.display="none"}function Re(){var t=e.fnTooltipUpgradeDesc;e.fnTooltipUpgradeDesc=function(n){var a=e.$J(n),i=a.data("desc"),r=i,o=parseFloat(a.data("multiplier"));switch(a.data("upgrade_type")){case 2:r=t(n);var l=Ce()*Ee(),m=e.g_Minigame.CurrentScene().m_rgTuningData.player.damage_per_click*(be()+o)*Ee();r+="<br><br>Crit Click: "+e.FormatNumberForDisplay(l)+" => "+e.FormatNumberForDisplay(m);break;case 7:var c=Ee(),d=c+o,s=ve(),u=Ce();r+="<br><br>You can have multiple crits in a second. The server combines them into one.",r+="<br><br>Crit Percentage: "+fe().toFixed(1)+"%",r+="<br><br>Critical Damage Multiplier:",r+="<br>Current: "+c+"x",r+="<br>Next Level: "+d+"x",r+="<br><br>Damage with one crit:",r+="<br>DPS: "+e.FormatNumberForDisplay(c*s)+" => "+e.FormatNumberForDisplay(d*s),r+="<br>Click: "+e.FormatNumberForDisplay(c*u)+" => "+e.FormatNumberForDisplay(d*u),r+="<br><br>Base Increased By: "+o.toFixed(1)+"x";break;case 9:r+="<br><br>Boss Loot Drop Rate:",r+="<br>Current: "+Te().toFixed(0)+"%",r+="<br>Next Level: "+(Te()+100*o).toFixed(0)+"%",r+="<br><br>Base Increased By: "+e.FormatNumberForDisplay(100*o)+"%";break;default:return t(n)}return r}}function De(){t().trt_oldbuy=e.g_Minigame.m_CurrentScene.TrySpendBadgePoints,e.g_Minigame.m_CurrentScene.TrySpendBadgePoints=function(n,a){if(1!=a)return void t().trt_oldbuy(n,a);var i=this,r=e.$J(n),o=e.$J(".name",n).text(),l=(r.data("type"),r.data("cost")),m=i.m_rgPlayerTechTree.badge_points,c=Math.floor(m/l),d=prompt("How many "+o+" do you want to buy? (max "+c+")",0);if(d){var s=parseInt(d);return isNaN(s)||0>s?void alert("Please enter a positive number."):i.m_rgPlayerTechTree.badge_points<l*s?void alert("Not enough badge points."):void t().trt_oldbuy(n,s)}}}function Le(){return t().m_rgGameData.level+1}function Me(){for(var n=Le(),a=0,i=0;2>=i;i++)"undefined"!=typeof e.g_Minigame.m_CurrentScene.m_rgLaneData[i].abilities[26]&&(a+=e.g_Minigame.m_CurrentScene.m_rgLaneData[i].abilities[26]);return n%ot.rainingRounds!=0?(mt=0,ct=0,dt=0,0):(dt!==a&&(mt++,ct+=a,dt=a),ct/mt*(t().m_rgGameData.timestamp-t().m_rgGameData.timestamp_level_start))}function Ae(){var t=20,n=setInterval(function(){var a=e.$J(".spend_badge_ponts_ctn"),i=!!(a&&a.length&&a.is(":visible"));i?(window.document.dispatchEvent(new Event("event:welcomePanelVisible")),clearInterval(n)):e.g_Minigame&&e.g_Minigame.CurrentScene()&&e.g_Minigame.CurrentScene().m_rgPlayerTechTree&&!e.g_Minigame.CurrentScene().m_rgPlayerTechTree.badge_points?clearInterval(n):--t<=0&&clearInterval(n)},500)}var Pe="6.0.8",xe=20,Ne=1,Ie=M("enableAutoClicker",!0),Ge=M("removeInterface",!0),Oe=M("removeParticles",!0),ke=M("removeFlinching",!0),we=M("removeCritText",!1),Be=M("removeGoldText",!1),Ue=M("removeAllText",!1),Fe=M("enableAutoRefresh","undefined"!=typeof GM_info),He=M("enableFingering",!0),Je=M("disableRenderer",!1),$e=M("useTrollTracker",!1),We=M("praiseGoldHelm",!0),qe=30,Ke=10,Xe=30,ze=!1,Ye=!1,Ve=!1,Qe=null,je=Ie?xe:0,Ze=0,et={"Original Gold Helm":"https://i.imgur.com/1zRXQgm.png","Moving Gold Helm":"http://i.imgur.com/XgT8Us8.gif","Golden Gaben":"http://i.imgur.com/ueDBBrA.png","Gaben + Snoop Dogg":"http://i.imgur.com/9R0436k.gif","Wormhole Gaben":"http://i.imgur.com/6BuBgxY.png",MSG2015:"http://i.imgur.com/zHI6C6X.png","Matrix Gaben":"http://i.imgur.com/titbsfQ.png","Praising Intensifies":"http://i.imgur.com/1ynXett.gif"},tt=L("praiseGoldHelmImage",et["Golden Gaben"]),nt="http://i.imgur.com/ieDoLnx.png",at=function(){},it=function(){},rt=function(){},ot={speedThreshold:2e3,rainingSafeRounds:5,rainingRounds:100,timePerUpdate:6e4,useSlowMode:!1,minsLeft:60,allowWormholeLevel:18e4,githubVersion:Pe,useAbilityChance:.03,useLikeNewMinChance:.02,useLikeNewMaxChance:.1,useGoldThreshold:200},lt=!1,mt=0,ct=0,dt=0,st=!1,ut=(M("showedUpdateInfo",!1),{}),gt={FIRE_WEAPON:1,CHANGE_LANE:2,RESPAWN:3,CHANGE_TARGET:4,MORALE_BOOSTER:5,GOOD_LUCK_CHARMS:6,MEDICS:7,METAL_DETECTOR:8,DECREASE_COOLDOWNS:9,TACTICAL_NUKE:10,CLUSTER_BOMB:11,NAPALM:12,RESURRECTION:13,CRIPPLE_SPAWNER:14,CRIPPLE_MONSTER:15,MAX_ELEMENTAL_DAMAGE:16,RAINING_GOLD:17,CRIT:18,PUMPED_UP:19,THROW_MONEY_AT_SCREEN:20,GOD_MODE:21,TREASURE:22,STEAL_HEALTH:23,REFLECT_DAMAGE:24,FEELING_LUCKY:25,WORMHOLE:26,LIKE_NEW:27},pt=[gt.MORALE_BOOSTER,gt.GOOD_LUCK_CHARMS,gt.TACTICAL_NUKE,gt.CLUSTER_BOMB,gt.NAPALM,gt.CRIT,gt.CRIPPLE_SPAWNER,gt.CRIPPLE_MONSTER,gt.MAX_ELEMENTAL_DAMAGE,gt.REFLECT_DAMAGE,gt.THROW_MONEY_AT_SCREEN],_t={SPAWNER:0,CREEP:1,BOSS:2,MINIBOSS:3,TREASURE:4};r(),e.SteamDB_Minigame_Timer&&e.clearInterval(e.SteamDB_Minigame_Timer),e.SteamDB_Minigame_Timer=e.setInterval(function(){e.g_Minigame&&t().m_bRunning&&t().m_rgPlayerTechTree&&t().m_rgGameData&&(e.clearInterval(e.SteamDB_Minigame_Timer),n(),e.SteamDB_Minigame_Timer=e.setInterval(l,1e3))},1e3),e.setTimeout(function(){e.g_Minigame&&e.g_Minigame.m_CurrentScene&&e.g_Minigame.m_CurrentScene.m_rgGameData||e.location.reload(!0)},1e3*Xe);var ht=document.querySelector(".breadcrumbs");if(ht){var yt=document.createElement("span");yt.textContent=" > ",ht.appendChild(yt),yt=document.createElement("span"),yt.style.color="#D4E157",yt.style.textShadow="1px 1px 0px rgba( 0, 0, 0, 0.3 )",yt.textContent="Room "+e.g_GameID,ht.appendChild(yt),yt=document.createElement("span"),yt.textContent=" > ",ht.appendChild(yt),yt=document.createElement("span"),yt.style.color="#FFA07A",yt.style.textShadow="1px 1px 0px rgba( 0, 0, 0, 0.3 )",yt.textContent="Level: 0, Expected Level: 0, Likely Level: 0",ht.appendChild(yt),document.ExpectedLevel=yt,yt=document.createElement("span"),yt.textContent=" > ",ht.appendChild(yt),yt=document.createElement("span"),yt.style.color="#9AC0FF",yt.style.textShadow="1px 1px 0px rgba( 0, 0, 0, 0.3 )",yt.textContent="Remaining Time: 0 hours, 0 minutes.",ht.appendChild(yt),document.RemainingTime=yt}e.document.addEventListener("event:welcomePanelVisible",function(){e.$J("#badge_items > .purchase_ability_item > .sub_item").each(function(){var t=e.$J(this),n=e.$J('<div class="sub_item x100">x100</div>');n.click(function(t){e.g_Minigame.CurrentScene().TrySpendBadgePoints(this,100),t.stopPropagation()}),n.data(t.data()),t.css("margin-right","50px"),t.after(n)});var t=e.g_Minigame.CurrentScene().m_UI.UpdateSpendBadgePointsDialog;e.g_Minigame.CurrentScene().m_UI.UpdateSpendBadgePointsDialog=function(){t.apply(e.g_Minigame.CurrentScene().m_UI,arguments);var n=e.g_Minigame.CurrentScene().m_rgPlayerTechTree.badge_points;e.$J("#badge_items > .purchase_ability_item > .sub_item.x100").each(function(){var t=e.$J(this);n<100*t.data().cost?t.addClass("disabled"):t.removeClass("disabled")})}},!1)}(window);